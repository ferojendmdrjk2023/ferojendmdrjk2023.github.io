<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Anthology - The TaySwift Lyric Make Easy</title>
    <link rel="stylesheet" href="style.css">
</head>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #FDF6E4;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: #FDF6E4;
        }

        .search-bar-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            border-bottom: 1px solid #ccc;
            background: #C9B998;
            z-index: 1000;
            display: flex;
            align-items: center;
        }

        .search-bar {
            width: 90%;
            height: 25px;
            margin: 5px;
            padding: 5px;
            background-color: #FDF6E4;
            border-radius: 5px;
            border-style: none;  
        }

        .album-container {
            padding: 60px 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        .card {
            width: 45%;
            margin: 2%;
            background-color: white;
            border: 1px solid black;
            text-align: center;
            cursor: pointer;
            border-radius: 10px;
            overflow: hidden;
        }

        .albumcard {
            background-size: cover;
            background-position: center;
            width: 100%;
            height: 150px;
        }

        .track-card {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #C9B998;
            padding: 10px;
            overflow-y: auto;
            display: none;
            z-index: 2000;
        }

        .track-item {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #FDF6E4;
        }

        .album-name {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        #btn {
            margin: 10px 5px 0 0;
            padding: 8px 15px;
            background-color:#C9B998;
            color: #FDF6E4;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: #5C4A1D;
        }

       
        .navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px;
            background: #C9B998;
            display: flex; /* Ensure it is always displayed */
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #ccc;
            z-index: 3000; /* Ensure it stays above other elements */
        }

        .navbar button {
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: #5C4A1D;
        }

        .lyric-card {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            padding: 10px;
            overflow-y: auto;
            display: none;
            z-index: 2000;
        }

        .lyric-controls {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 10px; /* Spacing between buttons */
}

.lyric-controls button {
    padding: 10px 15px;
    font-size: 14px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background-color: #007bff;
    color: white;
}

.lyric-controls button:hover {
    background-color: #0056b3;
}

.lyric-controls button:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
}

#lyric-card img {
    width: 100%;
}

           
.error-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color:  #C9B998;
    color: #5C4A1D;
    padding: 20px;
    border-radius: 5px;
    font-size: 16px;
    font-weight: 700;
    text-align: center;
    z-index: 1000;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
}


    </style>
    <body>
        <div class="container">
            <div class="search-bar-container">
                <i class="fa fa-search" id="search-icon"></i>
                <input type="text" class="search-bar" id="search-input" placeholder="Search Track Title">
            </div>
        
            <div class="navbar">
                <button id="main-home">HOME</button>
                <button id="song">SONG</button>
                <button id="meet">MEET</button>
                <button id="profile">PROFILE</button>
            </div>
        
            <div class="album-container" id="album-container" style="display: flex;">
            </div>
        
            <div class="track-card" id="track-card" style="display: none;">
                <div class="navbar">
                    <button id="track-home">HOME</button>
                </div>
            </div>
        
            <div class="lyric-card" id="lyric-card" style="display: none;">
                <div class="navbar">
                    <button id="lyric-home">HOME</button>
                    <button id="lyric-song">SONG</button>
                </div>
            </div>
        </div>
    
       
    </body>    
    </html>

    <!-- <script src="app.js"></script> -->
<script>    // Class 1: Token Management and Spotify Authentication
class SpotifyAuth {
    constructor() {
        this.clientId = 'f3907983afa34754a63b4a556626b6a1';
        this.clientSecret = '06029c14fa444bac982fa48a020c5c01';
        this.token = null;
    }

    loadToken(callback) {
        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = () => {
            if (xhttp.readyState === 4 && xhttp.status === 200) {
                let data = JSON.parse(xhttp.responseText);
                this.token = data.access_token;
                callback(this.token);
            }
        };

        xhttp.open('POST', 'https://accounts.spotify.com/api/token', true);
        xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhttp.setRequestHeader(
            'Authorization',
            'Basic ' + btoa(this.clientId + ':' + this.clientSecret)
        );
        xhttp.send('grant_type=client_credentials');
    }
}


class SpotifyApp {
    constructor() {
        this.auth = new SpotifyAuth();
        this.token = null;
    }

    setupNavigation() {
        let trackCard = document.getElementById('track-card');
        let albumContainer = document.getElementById('album-container');
        let lyricCard = document.getElementById('lyric-card');

        document.getElementById('main-home').onclick = () => {
            lyricCard.style.display = 'none';
            trackCard.style.display = 'none';
            albumContainer.style.display = 'flex';
        };

        document.getElementById('lyric-home').onclick = () => {
            lyricCard.style.display = 'none';
            trackCard.style.display = 'block';
        };

        document.getElementById('lyric-song').onclick = () => {
            lyricCard.style.display = 'none';
            trackCard.style.display = 'block';
        };

        document.getElementById('track-home').onclick = () => {
            trackCard.style.display = 'none';
            albumContainer.style.display = 'flex';
        };

        document.getElementById('song').addEventListener('click', () => {
            this.actionSongButtonClick();
        });
    }

    searchArtist(artistName, callback) {
        fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(artistName)}&type=artist`, {
            headers: { 'Authorization': `Bearer ${this.token}` }
        })
            .then(response => response.json())
            .then(data => callback(data.artists.items[0]?.id || null))
            .catch(err => console.error('Error searching artist:', err));
    }

    actionSongButtonClick() {
        this.auth.loadToken((token) => {
            this.token = token;
            const albumManager = new AlbumManager(this.token);
            const trackManager = new TrackManager(this.token);

            this.searchArtist('Taylor Swift', (artistId) => {
                if (artistId) {
                    albumManager.getAlbums(artistId, (albums) => {
                        let allTracks = [];
                        let pending = albums.length;

                        albums.forEach(album => {
                            trackManager.getTracks(album.id, (tracks) => {
                                tracks.forEach(track => {
                                    track.albumName = album.name;
                                });

                                allTracks.push(...tracks);
                                pending--;

                                if (pending === 0) {
                                    allTracks.sort((a, b) => a.name.localeCompare(b.name));
                                    trackManager.displayTracks(allTracks);
                                }
                            });
                        });
                    });
                }
            });
        });
    }

    init() {
        this.auth.loadToken((token) => {
            this.token = token;
            const albumManager = new AlbumManager(this.token);

            this.searchArtist('Taylor Swift', (artistId) => {
                if (artistId) {
                    albumManager.getAlbums(artistId, (albums) => {
                        albumManager.displayAlbums(albums);
                    });
                }
            });

            // Call navigation setup
            this.setupNavigation();
        });
    }
}




// Class 2: Handle Album Display
class AlbumManager {
    constructor(token) {
        this.token = token;
    }
 
    getAlbums(artistId, callback) {
        fetch(`https://api.spotify.com/v1/artists/${artistId}/albums?limit=50`, {
            headers: { 'Authorization': `Bearer ${this.token}` }
        })
            .then(response => response.json())
            .then(data => callback(data.items || []))
            .catch(err => console.error('Error fetching albums:', err));
    }

    displayAlbums(albums) {
        let albumContainer = document.getElementById('album-container');
        albumContainer.innerHTML = ''; // Clear previous content

        const filteredAlbums = albums.filter(album => {
            const name = album.name.toLowerCase();
            return !(
                name.includes('live') ||
                name.includes('remix') ||
                name.includes('acoustic')
            );
        });

        filteredAlbums.sort((a, b) => new Date(a.release_date) - new Date(b.release_date));

        filteredAlbums.forEach(album => {
            let card = document.createElement('div');
            card.classList.add('card');

            let albumImage = document.createElement('div');
            albumImage.classList.add('albumcard');
            albumImage.style.backgroundImage = `url(${album.images[0]?.url || ''})`;

            let albumName = document.createElement('h4');
            albumName.textContent = album.name;

            card.appendChild(albumImage);
            card.appendChild(albumName);

            card.onclick = () => {
                const trackManager = new TrackManager(this.token);
                trackManager.getTracks(album.id, (tracks) => {
                    tracks.forEach(track => {
                        track.albumName = album.name;
                    });
                    trackManager.displayTracks(tracks);
                });
            };

            albumContainer.appendChild(card);
        });
    }
}

class TrackManager {
    constructor(token) {
        this.token = token;
        this.currentAudio = null;
        this.setupNavbarListeners();
    }

    getTracks(albumId, callback) {
        fetch(`https://api.spotify.com/v1/albums/${albumId}/tracks`, {
            headers: { 'Authorization': `Bearer ${this.token}` }
        })
            .then(response => response.json())
            .then(data => callback(data.items || []))
            .catch(err => {});
    }

    displayTracks(tracks) {
        let trackContainer = document.getElementById('track-card');
        trackContainer.innerHTML = '';
        trackContainer.style.display = 'block';
        document.getElementById('album-container').style.display = 'none';

        tracks.forEach(track => {
            let trackItem = document.createElement('div');
            trackItem.classList.add('track-item');

            let trackTitle = document.createElement('div');
            trackTitle.textContent = track.name;

            let albumInfo = document.createElement('div');
            albumInfo.classList.add('album-name');
            albumInfo.textContent = `Album: ${track.albumName || 'Unknown'}`;

            let playButton = document.createElement('button');
            playButton.id = 'btn';
            playButton.textContent = 'Play Song';
            playButton.onclick = () => {
                this.playAudioTrack(track.id);
            };

            let stopButton = document.createElement('button');
            stopButton.id = 'btn';
            stopButton.textContent = 'Stop Song';
            stopButton.onclick = () => {
                this.stopAudio();
            };

            let lyricButton = document.createElement('button');
            lyricButton.id = 'btn';
            lyricButton.textContent = 'Show Lyric';
            lyricButton.onclick = () => {
                this.stopAudio();
                this.fetchAndDisplayLyrics(track.id);
            };

            trackItem.appendChild(trackTitle);
            trackItem.appendChild(albumInfo);
            trackItem.appendChild(playButton);
            trackItem.appendChild(stopButton);
            trackItem.appendChild(lyricButton);

            trackContainer.appendChild(trackItem);
        });
    }

    fetchAndDisplayLyrics(trackId) {
        fetch('songs.xml')
            .then(response => response.text())
            .then(xmlString => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, 'application/xml');
                const trackElements = xmlDoc.getElementsByTagName('track');

                for (let track of trackElements) {
                    const trackIdElement = track.getElementsByTagName('track_id')[0];
                    if (trackIdElement && trackIdElement.textContent === trackId) {
                        const imageUrl = track.getElementsByTagName('lyric_content')[0]?.textContent;
                        this.displayLyrics(imageUrl, trackId);
                        return;
                    }
                }
                this.displayLyrics(null, trackId);
            })
            .catch(err => {});
    }

    displayLyrics(imageUrl, trackId) {
        this.stopAudio();

        const lyricContainer = document.getElementById('lyric-card');
        lyricContainer.innerHTML = imageUrl
            ? `<img src="${imageUrl}" style="width: 100%">`
            : '<p>Lyric and Chord are in progress.</p>';
        lyricContainer.style.display = 'block';
        document.getElementById('track-card').style.display = 'none';

        const controls = document.createElement('div');
        controls.classList.add('lyric-controls');

        const playButton = document.createElement('button');
        playButton.id = 'btn';
        playButton.textContent = 'Play Song';
        playButton.onclick = () => {
            this.playAudioTrack(trackId, 'lyric-card');
        };

        const stopButton = document.createElement('button');
        stopButton.id = 'btn';
        stopButton.textContent = 'Stop Song';
        stopButton.onclick = () => {
            this.stopAudio();
        };

        controls.appendChild(playButton);
        controls.appendChild(stopButton);

        lyricContainer.appendChild(controls);
    }

    playAudioTrack(trackId, errorContainerId = 'track-card') {
        fetch('songs.xml')
            .then(response => response.text())
            .then(xmlString => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, 'application/xml');
                const trackElements = xmlDoc.getElementsByTagName('track');

                for (let track of trackElements) {
                    const trackIdElement = track.getElementsByTagName('track_id')[0];
                    if (trackIdElement && trackIdElement.textContent === trackId) {
                        const audioPath = track.getElementsByTagName('audiotrack')[0]?.textContent;
                        if (audioPath) {
                            this.playAudio(audioPath);
                        } else {
                            this.displayErrorMessage("Audiotrack is unavailable for this song.", errorContainerId);
                        }
                        return;
                    }
                }
                this.displayErrorMessage("Track not found.", errorContainerId);
            })
            .catch(err => {});
    }

    playAudio(audioPath) {
        if (this.currentAudio) {
            this.currentAudio.pause();
            this.currentAudio.currentTime = 0;
        }

        this.currentAudio = new Audio(audioPath);
        this.currentAudio.play();

        this.currentAudio.onended = () => {
            this.currentAudio = null;
        };
    }

    stopAudio() {
        if (this.currentAudio) {
            this.currentAudio.pause();
            this.currentAudio.currentTime = 0;
            this.currentAudio = null;
        }
    }

    displayErrorMessage(message, containerId = 'track-card') {
        const container = document.getElementById(containerId);
        if (!container) return;

        const errorContainer = document.createElement('div');
        errorContainer.classList.add('error-popup');
        errorContainer.textContent = message;

        container.appendChild(errorContainer);

        setTimeout(() => {
            errorContainer.remove();
        }, 3000);
    }

    setupNavbarListeners() {
        const navbarButtons = document.querySelectorAll('.navbar button');
        navbarButtons.forEach(button => {
            button.addEventListener('click', () => {
                this.stopAudio();
            });
        });
    }
}







// Instantiate and initialize the app
const app = new SpotifyApp();
app.init();

    </script>